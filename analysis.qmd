---
title: "Analysis"
editor: 
  markdown: 
    wrap: 72
---

Loading necessary libraries :

```{r}
#| warning: false
#| code-fold: true
#| code-summary: "Show the code"
library(readxl)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(knitr)
library(ggrepel)


```

Load the data:

```{r}
#| code-fold: true
#| code-summary: "Show the code"
load("library_museum_updated.RData")
data <-library_museum_updated
```

## 1) Relationship between Population and the Number of books in the library

```{r}
#| code-fold: true
#| code-summary: "Show the code"
# Veri türlerini düzelt
data$population <- as.numeric(data$population)
data$book_num <- as.numeric(data$book_num)


# Korelasyon hesapla
cor_pop_book <- cor(data$population, data$book_num)
cat("Correlation between Population and Number of Books:",cor_pop_book,"\n")
```

The correlation of 0.8455922 indicates a strong positive relationship
between population and the number of books. In other words, as the
population of cities generally increases, there is a tendency for the
number of books in libraries to increase as well. Let's try to support
this with visualizations.

### Plots

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data, aes(x = population, y = book_num)) +
  geom_point(color = "purple") +  
  geom_smooth(method = "lm", se = FALSE, color = "yellow", formula = y ~ x)+ 
  labs(x = "Population", y = "Book Count") + 
  ggtitle("Scatter Plot of Population vs Book Count") +
  theme_minimal() +
  theme(plot.title = element_text(size = 12, hjust = 0.5),axis.text.x = element_text(angle = 45, hjust = 1, size = 6)) +
  scale_x_continuous(labels = scales::comma, breaks = seq(0, 15000000, by = 1000000))
```

According to the 2022 data from the Turkish Statistical Institute, 97.6%
of the cities in Turkey have a population of less than 5 million. As
seen in the above graph, the areas where the points are dense correspond
to locations with a population of less than 5 million. For this reason,
the following plot was created.

```{r}
#| code-fold: true
#| code-summary: "Show the code"
data %>%
  filter(population <= 5000000) %>%
  ggplot(aes(x = population, y = book_num)) +
  geom_point(color = "purple") +  
  geom_smooth(method = "lm", se = FALSE, color = "yellow", formula = y ~ x) + 
  labs(x = "Population", y = "Book Count") + 
  ggtitle("Scatter Plot of Population vs Book Count (Max 5 Million Population)") +
  theme_minimal() +
  theme(plot.title = element_text(size = 12, hjust = 0.5), axis.text.x = element_text(angle = 45, hjust = 1, size = 6)) +
  scale_x_continuous(labels = scales::comma, breaks = seq(0, 5000000, by = 1000000))+ scale_y_continuous(labels = scales::comma)
```

We supported the correlation results with visualizations. We can say
that there is a tendency for the number of books in libraries to
increase as the population in cities generally increases.

### 2) The number of historical remnants in cities in Türkiye

```{r}
#| code-fold: true
#| code-summary: "Show the code"
top5_ruins <- data %>%
  filter(year == 2022) %>%
  arrange(desc(ruins_num)) %>%
  head(5) %>%
  select(city, ruins_num)
kable(top5_ruins, 
      format = "html", 
      caption = "Top 5 Cities in Turkey with the Highest Number of Historical Remnants in 2022",
      col.names = c("City", "Historical Remnants"),
      align = c("c", "c")) 
```

```{r}
#| code-fold: true
#| code-summary: "Show the code"
data %>%
  filter(year == 2022 & ruins_num > 0) %>%
  mutate(city = factor(city, levels = unique(city[order(ruins_num, decreasing = FALSE)]))) %>%
  arrange(desc(ruins_num)) %>%
  ggplot(aes(x = city, y = ruins_num)) +
  geom_bar(stat = "identity", fill = "purple", color = "yellow") +
  labs(x = "City", y = "Number of Historical Remnants") +
  ggtitle("The number of historical remnants in cities in Türkiye (2022)") +
  theme_minimal() +
  theme(legend.position = "none",
        axis.text.x = element_text(angle = 0, hjust = 1, size = 5),
        axis.text.y = element_text(size = 8),
        plot.title = element_text(size = 12, hjust = 0.5)) +
  scale_x_discrete(breaks = unique(data$city)) +
  scale_y_continuous(breaks = seq(0, max(data$ruins_num), by = 1))+
  coord_flip()

```

```{r}
#| code-fold: true
#| code-summary: "Show the code"
data %>%
  filter(year == 2022) %>%
  mutate(book_per_person=book_num/population,city = factor(city, levels = unique(city[order(book_per_person, decreasing = TRUE)]))) %>%
  ggplot(aes(x = city, y = book_per_person * 100)) +
  geom_point(color = "purple") +  
  geom_smooth(method = "lm", se = FALSE, color = "yellow", formula = y ~ x) + 
  labs(x = "Cities", y = "Book Number Per Population (*100)") + 
  ggtitle("Scatter Plot of Cities vs Book Number Per Population") +
  theme_minimal() +
  theme(plot.title = element_text(size = 12, hjust = 0.5), axis.text.x = element_text(angle = 90, hjust = 1, size = 6))
```

```{r}
#| code-fold: true
#| code-summary: "Show the code"
data %>%
  filter(year == 2022) %>%
  mutate(museum_per_person=((ministry_museum_num + private_museum_num)/population), city = factor(city, levels = unique(city[order(museum_per_person, decreasing = TRUE)]))) %>%
  ggplot(aes(x = city, y = museum_per_person * 100000)) +
  geom_point(color = "purple") +  
  geom_smooth(method = "lm", se = FALSE, color = "yellow", formula = y ~ x) + 
  labs(x = "Cities", y = "Museum Number Per Population (*100000)") + 
  ggtitle("Scatter Plot of Cities vs Museum Number Per Population") +
  theme_minimal() +
  theme(plot.title = element_text(size = 12, hjust = 0.5), axis.text.x = element_text(angle = 90, hjust = 1, size = 6))

```

```{r}

 #| code-fold: true #|
 #| code-summary: "Show the code"
  data |> group_by(year)|> summarize(user=sum(user_num)/10000)|>
 ggplot(aes(x=year,y=user))+ geom_line(color="blue")

```


```




```


```{r}

data_2020 <- data %>%
  filter(year == 2020)

top_literacy_cities_2020 <- data_2020 %>%
  arrange(desc(literacy_rate)) %>%
  slice_head(n = 10)

ggplot(top_literacy_cities_2020, aes(x = loaned_book_num, y = suicides_num, color = city)) +
  geom_point() +
  geom_text_repel(aes(label = city)) +
  labs(x = "Loaned Book Number", y = "Number of Suicides",
       title = "The Effect of Literacy Rate on Suicide Rates") +
  theme_minimal() +
  theme(legend.position = "right") 
```


<<<<<<< HEAD


```{r}
#| code-fold: true
#| code-summary: "Show the code"
top_literacy_cities <- data %>%
  arrange(desc(literacy_rate)) %>%
  slice_head(n = 10)

ggplot(top_literacy_cities, aes(x = loaned_book_num, y = suicides_num, colour = city)) +
  geom_point(size = 3) +
  geom_text_repel(aes(label = city), max.overlaps = 10) +
  labs(x = "Loaned Book Number", y = "Number of Suicides",
       title = "Scatter Plot of Number of Suicides vs Loaned Book Number for Top 10 Literate Cities") +
  theme_minimal() +
  theme(legend.position = "bottom")  # Efsaneyi altta göstermek içi

```
```{r}
#| code-fold: true
#| code-summary: "Show the code"
data$population <- as.numeric(data$population)
data$book_num <- as.numeric(data$book_num)
data$public_lib <- as.numeric(data$public_lib)
data$user_num <- as.numeric(data$user_num)
data$user_num_per_thousand <- as.numeric(data$user_num_per_thousand)
data$loaned_book_num <- as.numeric(data$loaned_book_num)
data$ministry_museum_piece_num <- as.numeric(data$ministry_museum_piece_num)
data$ministry_museum_num <- as.numeric(data$ministry_museum_num)
data$ministry_museum_visitor_num <- as.numeric(data$ministry_museum_visitor_num)
data$ruins_num <- as.numeric(data$ruins_num)
data$private_museum_piece_num <- as.numeric(data$private_museum_piece_num)
data$private_museum_personnel_num <- as.numeric(data$private_museum_personnel_num)
data$private_museum_num <- as.numeric(data$private_museum_num)
data$private_museum_visitor_num <- as.numeric(data$private_museum_visitor_num)
data$cinema_audiences_num <- as.numeric(data$cinema_audiences_num)
data$theater_audiences_num <- as.numeric(data$theater_audiences_num)
data$literacy_rate <- as.numeric(data$literacy_rate)
data$suicides_num <- as.numeric(data$suicides_num)

cor_pop_book_2 <- cor(data$population, data$public_lib)
cat("Correlation between Population and Number of Library:",cor_pop_book_2,"\n")

cor_pop_book_3 <- cor(data$book_num, data$public_lib)
cat("Correlation between Number of Book and Number of Library:",cor_pop_book_3,"\n")

cor_pop_book_4 <- cor(data$user_num, data$public_lib)
cat("Correlation between User Number and Number of Library:",cor_pop_book_4,"\n")

cor_pop_book_5 <- cor(data$literacy_rate, data$public_lib)
cat("Correlation between Literacy Rate and Number of Library:",cor_pop_book_5,"\n")

```

```{r}
data_subset <- data %>%
  filter(year %in% c(2015, 2016, 2017, 2018, 2019, 2020, 2021))

model <- lm(public_lib ~ population + book_num + user_num + literacy_rate, data = data_subset)
summary(model)

new_data_2022 <- data %>%
  filter(year == 2022) 

new_data_2022 <- data.frame(
  population = new_data_2022$population,
  book_num = new_data_2022$book_num,
  user_num = new_data_2022$user_num,
  literacy_rate = new_data_2022$literacy_rate
)

predictions_2022 <- predict(model, new_data_2022)
predictions_2022






```
