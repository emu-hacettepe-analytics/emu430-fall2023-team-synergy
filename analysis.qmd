---
title: "Analysis"
---

Loading necessary libraries :

```{r}
#| warning: false
#| code-fold: true
#| code-summary: "Show the code"
library(readxl)
library(ggplot2)
library(tidyverse)
library(dplyr)
```

Load the data:

```{r}
#| code-fold: true
#| code-summary: "Show the code"
load("library_museum_updated.RData")
data <-library_museum_updated
```

## 1) Relationship between Population and the Number of books in the library

```{r}
#| code-fold: true
#| code-summary: "Show the code"
# Veri türlerini düzelt
data$population <- as.numeric(data$population)
data$book_num <- as.numeric(data$book_num)


# Korelasyon hesapla
cor_pop_book <- cor(data$population, data$book_num)
cat("Correlation between Population and Number of Books:",cor_pop_book,"\n")
```

The correlation of 0.8455922 indicates a strong positive relationship between population and the number of books. In other words, as the population of cities generally increases, there is a tendency for the number of books in libraries to increase as well. Let's try to support this with visualizations.

### Plots

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data, aes(x = population, y = book_num)) +
  geom_point(color = "purple") +  
  geom_smooth(method = "lm", se = FALSE, color = "yellow", formula = y ~ x)+ 
  labs(x = "Population", y = "Book Count") + 
  ggtitle("Scatter Plot of Population vs Book Count") +
  theme_minimal() +
  theme(plot.title = element_text(size = 12, hjust = 0.5),axis.text.x = element_text(angle = 45, hjust = 1, size = 6)) +
  scale_x_continuous(labels = scales::comma, breaks = seq(0, 15000000, by = 1000000))
```

According to the 2022 data from the Turkish Statistical Institute, 97.6% of the cities in Turkey have a population of less than 5 million. As seen in the above graph, the areas where the points are dense correspond to locations with a population of less than 5 million. For this reason, the following plot was created.

```{r}
#| code-fold: true
#| code-summary: "Show the code"
data %>%
  filter(population <= 5000000) %>%
  ggplot(aes(x = population, y = book_num)) +
  geom_point(color = "purple") +  
  geom_smooth(method = "lm", se = FALSE, color = "yellow", formula = y ~ x) + 
  labs(x = "Population", y = "Book Count") + 
  ggtitle("Scatter Plot of Population vs Book Count (Max 5 Million Population)") +
  theme_minimal() +
  theme(plot.title = element_text(size = 12, hjust = 0.5), axis.text.x = element_text(angle = 45, hjust = 1, size = 6)) +
  scale_x_continuous(labels = scales::comma, breaks = seq(0, 5000000, by = 1000000))+ scale_y_continuous(labels = scales::comma)
```

We supported the correlation results with visualizations. We can say that there is a tendency for the number of books in libraries to increase as the population in cities generally increases.

```{r}
#| code-fold: true
#| code-summary: "Show the code"
data %>%
  filter(year == 2022) %>%
  mutate(book_per_person=book_num/population,city = factor(city, levels = unique(city[order(book_per_person, decreasing = TRUE)]))) %>%
  ggplot(aes(x = city, y = book_per_person * 100)) +
  geom_point(color = "purple") +  
  geom_smooth(method = "lm", se = FALSE, color = "yellow", formula = y ~ x) + 
  labs(x = "Cities", y = "Book Number Per Population (*100)") + 
  ggtitle("Scatter Plot of Cities vs Book Number Per Population") +
  theme_minimal() +
  theme(plot.title = element_text(size = 12, hjust = 0.5), axis.text.x = element_text(angle = 90, hjust = 1, size = 6))
```

```{r}
#| code-fold: true
#| code-summary: "Show the code"
data %>%
  filter(year == 2022) %>%
  mutate(museum_per_person=((ministry_museum_num + private_museum_num)/population), city = factor(city, levels = unique(city[order(museum_per_person, decreasing = TRUE)]))) %>%
  ggplot(aes(x = city, y = museum_per_person * 100000)) +
  geom_point(color = "purple") +  
  geom_smooth(method = "lm", se = FALSE, color = "yellow", formula = y ~ x) + 
  labs(x = "Cities", y = "Museum Number Per Population (*100000)") + 
  ggtitle("Scatter Plot of Cities vs Museum Number Per Population") +
  theme_minimal() +
  theme(plot.title = element_text(size = 12, hjust = 0.5), axis.text.x = element_text(angle = 90, hjust = 1, size = 6))

```



```{r}
#| code-fold: true
#| code-summary: "Show the code"
library(ggplot2)
library(ggrepel)
library(dplyr)

# Veri setini yükleyin ve 'data' adı altında atayın
load("library_museum_updated.RData")
data <- library_museum_updated

# Yüksek 'cinema_audiences_num' değerlerine sahip 2020 yılı verisini hazırlayın
top_cities_2020 <- data %>%
  filter(year == 2020) %>%
  arrange(desc(cinema_audiences_num)) %>%
  slice(1:10)

# Scatter plot oluşturun ve etiketleri iyileştirin
ggplot(top_cities_2020, aes(x = population, y = cinema_audiences_num, label = city)) +
  geom_point() +
  geom_text_repel(size = 3.5) + # Etiketlerin çakışmasını önleyin
  theme_minimal() +
  labs(title = "Top 10 Cities by Cinema Audiences in 2020",
       x = "Population",
       y = "Cinema Audiences Number") +
  scale_x_continuous(labels = scales::comma, limits = c(NA, 1.5e7)) + # X ekseni sınırlarını ve etiket formatını ayarlayın
  scale_y_continuous(labels = scales::comma, limits = c(NA, 4e6)) # Y ekseni sınırlarını ve etiket formatını ayarlayın


```
